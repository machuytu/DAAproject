@model ProjectDAA1.Models.DBContext
@{
    ViewBag.Title = "GetKQHT";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="site-section">
    <div class="container">
        <br />
        <br />
        <div class="d-flex justify-content-center">
            <h2 class="text-uppercase font-weight-bold"> KẾT QUẢ HỌC TẬP </h2>
        </div>
        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th></th>
                    <th>Mã</th>
                    <th>Tên</th>
                    <th>Tín chỉ</th>
                    <th>Điểm QT</th>
                    <th>Điểm TH</th>
                    <th>Điểm GK</th>
                    <th>Điểm CK</th>
                    <th>Điểm TB</th>
                </tr>
            </thead>
            <tbody id="tb">
                @{
                    var listdiemtong = new List<double?>();
                    int? tongtctl = 0;
                    int? tongtc = 0;
                    foreach (var dk in Model.dsdkhp)
                    {
                        <tr class="table-active"><th colspan="9">Học kỳ @dk.hocky năm học @dk.namhoc</th></tr>
                        var listdiemhk = new List<double?>();
                        int? tchk = 0;
                        int? tctlhk = 0;
                        foreach (var bd in Model.dsbd)
                        {
                            if (bd.iddkhp == dk.iddkhp)
                            {
                                tchk += bd.sotc;
                                listdiemhk.Add(bd.diemtb);
                                if (bd.diemtb.HasValue)
                                {
                                    tctlhk += bd.sotc;
                                }
                                <tr>
                                    <td>@listdiemhk.Count()</td>
                                    <td>@bd.mamon</td>
                                    <td>@bd.tenmon</td>
                                    <td>@bd.sotc.ToString()</td>
                                    <td>@bd.diemqt.ToString()</td>
                                    <td>@bd.diemth.ToString()</td>
                                    <td>@bd.diemgk.ToString()</td>
                                    <td>@bd.diemck.ToString()</td>
                                    <td>@bd.diemtb.ToString()</td>
                                </tr>
                            }
                        }
                        listdiemtong.Add(listdiemhk.Average());
                        tongtctl += tctlhk;
                        tongtc += tchk;
                        <tr>
                            <th colspan="3">Trung bình học kỳ: </th>
                            <th>@tchk</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>@listdiemhk.Average()</th>
                        </tr>
                    }
                    <tr>
                        <th colspan="3">Tổng tín chỉ đã học: </th>
                        <th>@tongtc</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="3">Tổng tín chỉ tích luỹ: </th>
                        <th>@tongtctl</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                    <tr>
                        <th colspan="3">Điểm: </th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>@listdiemtong.Average()</th>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

