@model ProjectDAA1.Models.DBContext
@{
    ViewBag.Title = "GetKQHT";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="site-section">
    <div class="container">
        <br />
        <br />
        <br />
        <table class="table table-bordered">
            <thead>
                <tr class="text-center">
                    <th>Họ tên</th>
                    <th>Mã SV</th>
                    <th>Ngày sinh</th>
                    <th>Giới tính</th>
                    <th>Lớp chủ nhiệm</th>
                    <th>Khoa</th>
                    <th>Bậc học</th>
                </tr>
            </thead>
            <tbody>
                <tr class="text-center">
                    <td>@ViewBag.sv.hoten</td>
                    <td>@ViewBag.sv.masv</td>
                    <td>@ViewBag.sv.gioitinh</td>
                    <td>@ViewBag.sv.ngaysinh.ToString("dd-MM-yyyy")</td>
                    <td>@ViewBag.sv.lopcn.malopcn</td>
                    <td>@ViewBag.sv.lopcn.khoa.makhoa</td>
                    <td>@ViewBag.sv.bachoc</td>
                </tr>
            </tbody>
        </table>
        <h2 class="text-uppercase text-center font-weight-bold"> KẾT QUẢ HỌC TẬP </h2>
        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th></th>
                    <th>Mã</th>
                    <th>Tên</th>
                    <th>Tín chỉ</th>
                    <th>Điểm QT</th>
                    <th>Điểm TH</th>
                    <th>Điểm GK</th>
                    <th>Điểm CK</th>
                    <th>Điểm TB</th>
                </tr>
            </thead>
            <tbody id="tb">
                @{
                    var listdiemtong = new List<double?>();
                    int? tongtctl = 0;
                    int? tongtc = 0;
                    foreach (var dk in Model.dsdkhp)
                    {
                        <tr class="table-active"><th colspan="9">Học kỳ @dk.hocky năm học @dk.namhoc</th></tr>
                        var listdiemhk = new List<double?>();
                        int? tchk = 0;
                        int? tctlhk = 0;
                        foreach (var bd in Model.dskqht)
                        {
                            if (bd.lop.iddkhp == dk.iddkhp)
                            {
                                tchk += bd.lop.mon.sotc;
                                listdiemhk.Add(bd.diemtb);
                                if (bd.diemtb.HasValue && bd.diemtb >= 5)
                                {
                                    tctlhk += bd.lop.mon.sotc;
                                }
                                <tr>
                                    <td>@listdiemhk.Count()</td>
                                    <td>@bd.lop.mon.mamon</td>
                                    <td>@bd.lop.mon.tenmon</td>
                                    <td>@bd.lop.mon.sotc.ToString()</td>
                                    <td title="Trọng số: @bd.lop.mon.trongsoqt%">@bd.diemqt.ToString()</td>
                                    <td title="Trọng số: @bd.lop.mon.trongsoth%">@bd.diemth.ToString()</td>
                                    <td title="Trọng số: @bd.lop.mon.trongsogk%">@bd.diemgk.ToString()</td>
                                    <td title="Trọng số: @bd.lop.mon.trongsock%">@bd.diemck.ToString()</td>
                                    <td>@bd.diemtb.ToString()</td>
                                </tr>
                            }
                        }
                        listdiemtong.Add(listdiemhk.Average());
                        tongtctl += tctlhk;
                        tongtc += tchk;
                        <tr>
                            <th colspan="3">Trung bình học kỳ: </th>
                            <th>@tchk</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>@listdiemhk.Average()</th>
                        </tr>
                    }
                }
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3">Tổng tín chỉ đã học: </th>
                    <th>@tongtc</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                <tr>
                    <th colspan="3">Tổng tín chỉ tích luỹ: </th>
                    <th>@tongtctl</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                <tr>
                    <th colspan="3">Điểm: </th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>@listdiemtong.Average()</th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

